# Stage 1 - Install dependencies and build
FROM oven/bun:1.1.36 as builder

WORKDIR /app

# Copy files
COPY . .

# Remove yarn.lock to avoid conflicts
RUN rm -f bun.lock yarn.lock
RUN bun install
RUN bun add -d concurrently

# Build (optional depending on app)
# RUN bun run build

# Stage 2 - Runtime
FROM oven/bun:1.1.36

WORKDIR /app

COPY --from=builder /app /app

# Copy environment configs
COPY apps/app/.env.example apps/app/.env
COPY apps/portal/.env.example apps/portal/.env
COPY packages/db/.env.example packages/db/.env

EXPOSE 3000

CMD ["bun", "run", "dev"]
